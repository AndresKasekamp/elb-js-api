import{I as y,bq as _,N as $,ab as E,ku as D,bl as b,b2 as R,B as h,fr as H,fq as L,e as m,y as v,c as P,g as k,mi as T,T as d,hX as z,W as I,E as V,gI as G,kv as O,b as c,kw as f}from"./index-pCX-0tJH.js";import{a as S}from"./HoveredPoints-dZcdNiOr.js";import{z as M,w,e as x}from"./GraphicState-JOHpeXmF.js";import"./AnchorElementViewModel-7brFN9z4.js";import"./ExtendedLineVisualElement-VJvEdv3K.js";import"./vec4f32-NvfHy9q7.js";import"./EngineVisualElement-u0-BOxGn.js";import"./VisualElement--2Scr6Yq.js";import"./Laserlines.glsl-U7nZFq0e.js";let A=class{constructor(e){this._params=e,this._highlightTask=null,this._highlightHandle=null,this._visualElementHandle=null,this._settings=new M({getTheme:()=>this._params.view.effectiveTheme})}destroy(){this.remove()}remove(){this._highlightTask=y(this._highlightTask),this._highlightHandle=_(this._highlightHandle),this._visualElementHandle=_(this._visualElementHandle)}showHighlight(e){if(this.remove(),e==null||!g(e))return;const i=e.layer;this._highlightTask=$(async t=>{const a=await this._params.view.whenLayerView(i);E(t),D(a)&&(this._highlightHandle=a.highlight(e))})}showReshaping(e){if(this.remove(),e==null)return;const i=this._params.view,t=new w({view:i,geometry:g(e)?e.geometry:null,attached:!1,elevationInfo:b(e),renderOccluded:R.OccludeAndTransparentStencil,isDecoration:!0}),a=new x({graphic:e}),s=[h(()=>a.isDraped,o=>{t.isDraped=o}),a.on("changed",()=>{t.geometry=g(e)?e.geometry:null}),i.trackGraphicState(a),i.maskOccludee(e),H(t)];this._settings.visualElements.lineGraphics.outline.apply(t),t.attached=!0,this._visualElementHandle=L(s)}};function g(n){return n.geometry!=null&&n.geometry.type==="polyline"}const C=100;let p=class extends k{constructor(n){super(n),this._chartData=null,this._visualElements=[]}initialize(){const n=T(e=>{this._update(e)},C);this.addHandles([h(()=>({spatialReference:this.view.spatialReference,chartData:this._chartData}),n,d),n])}destroy(){this._destroyVisualElements()}remove(){this._destroyVisualElements()}update(n){this._chartData=n}_update(n){const{chartData:e}=n;if(e==null)return this.remove();if(!e.refined)return;const i=this._visualElements,t=e.lines.filter(l=>l.viewVisualizationEnabled),a=t.length;for(;i.length>a;)i.pop().destroy();const s=G().profileLinesStyle3D;for(;i.length<a;){const l=new w({view:this.view,elevationInfo:{mode:"absolute-height",offset:0},innerWidth:s.width-s.outlineSize,width:s.width,falloff:s.falloff,color:s.outlineColor,renderOccluded:s.renderOccluded,isDecoration:!0});i.push(l)}const o=n.spatialReference;for(let l=0;l<a;++l){const u=i[l],r=t[a-1-l];u.geometry=this._createLineGeometry(r,o),u.innerColor=z(I.toUnitRGBA(r.color))}}_createLineGeometry(n,e){const i=n.samples??[],t=i.length-1,a=[];let s=[];for(let o=0;o<=t;o++){const{x:l,y:u,z:r}=i[o];r!=null&&s.push([l,u,r]),o!==t&&r!=null||!s.length||(a.push(s),s=[])}return new V({paths:a,hasZ:!0,spatialReference:e})}_destroyVisualElements(){this._visualElements.forEach(n=>n.destroy()),this._visualElements.length=0}};m([v()],p.prototype,"view",void 0),m([v()],p.prototype,"_chartData",void 0),p=m([P("esri.widgets.ElevationProfile.support.ProfileLines3D")],p);class K{constructor(e,i){this._handles=new O,this._inputRepresentation=new A({view:e}),this._hoveredPoints=new S({view:e}),this._profileLines=new p({view:e}),this._handles.add([h(()=>i.viewModel.hoveredPoints,t=>this._hoveredPoints.update(t),d),h(()=>{const{state:t,editable:a,highlightEnabled:s,viewModel:o}=i,l=o.input;return l&&(l.commitProperty("geometry"),l.commitProperty("layer")),{input:l,state:t,editable:a,highlightEnabled:s}},t=>this._updateInputRepresentation(t),d),h(()=>i.viewModel.chartData,t=>this._profileLines.update(t),d),h(()=>{var t;return(t=i.viewModel.input)==null?void 0:t.geometry},()=>{this._profileLines.remove()},d)])}destroy(){this._handles=c(this._handles),this._inputRepresentation=c(this._inputRepresentation),this._hoveredPoints=c(this._hoveredPoints),this._profileLines=c(this._profileLines)}_updateInputRepresentation({input:e,state:i,editable:t,highlightEnabled:a}){const s=this._inputRepresentation;if(!a)return s.remove();i===f.Selected?s.showHighlight(e):i!==f.Created||t?s.remove():s.showReshaping(e)}}export{K as ElevationProfileView3D};
