import{e as l,g as E,kL as T,W as n,y as a,c as D,b2 as o,k$ as x,hR as _,l0 as d,l1 as M,bU as F,z as W,b7 as O,b8 as v,bz as j,bO as I,ca as H,b9 as b,l2 as B,ba as U,i5 as R,bi as k,hV as q,gk as L,bF as V,l3 as N,bH as Y,hA as J,l4 as K,a8 as S}from"./index-pCX-0tJH.js";import{V as $}from"./ExtendedLineVisualElement-VJvEdv3K.js";import{r as A,t as Q}from"./vec4f32-NvfHy9q7.js";import{t as X}from"./EngineVisualElement-u0-BOxGn.js";import{c as Z}from"./Laserlines.glsl-U7nZFq0e.js";const f=.3;function g(s,e){e&&Object.assign(s,e)}class ee{constructor(e){this.height=90,this.coneHeight=40,this.coneWidth=23,this.width=3,this.renderOccluded=o.Opaque,this.color=e.accent}}class C{constructor({colors:e,...t}){this.size=11,this.outlineSize=1,this.collisionPadding=9,this.color=e.accent,this.outlineColor=e.outline,this.renderOccluded=o.Opaque,this.hoverOutlineColor=e.selectedOutline,g(this,t)}applyColor(e){this._apply(this.color,e)}applyOutline(e){this._apply(this.outlineColor,e)}applyHoverOutline(e){this._apply(this.hoverOutlineColor,e)}_apply(e,t){t.setParameters({color:d(e),renderOccluded:this.renderOccluded})}}let te=class{constructor({colors:e,...t}){this.size=40,this.height=.2,this.offset=.25,this.collisionPadding=2,this.renderOccluded=o.Transparent,this.minSquaredEdgeLength=900,this.color=_(e.accent,.5),this.hoverColor=e.accent,g(this,t)}applyColor(e){this._apply(this.color,e)}applyHover(e){this._apply(this.hoverColor,e)}_apply(e,t){t.setParameters({color:d(e),renderOccluded:this.renderOccluded})}};class re{constructor(e){this.vertex=new C({colors:e,color:e.accent,outlineColor:e.outline}),this.edge=new C({colors:e,color:x(_(e.accent,2/3),.5),outlineColor:_(e.outline,.5),size:8,collisionPadding:8}),this.selected=new C({colors:e,color:e.selected,outlineColor:e.outline}),this.edgeOffset=new te({colors:e})}}class w{constructor({colors:e,...t}){this.width=1.5,this.stipplePattern=M(3.3),this.falloff=0,this.innerWidth=1.5,this.renderOccluded=o.OccludeAndTransparent,this.color=e.selected,this.stippleOffColor=e.outline,this.innerColor=e.selected,g(this,t)}apply(e){e.color=d(this.color),e.width=this.width,e.stipplePattern=this.stipplePattern,e.stippleOffColor=d(this.stippleOffColor),e.falloff=this.falloff,e.innerWidth=this.innerWidth,e.innerColor=d(this.innerColor),e.renderOccluded=this.renderOccluded}}class se{constructor({colors:e,...t}){this.size=4,this.outlineSize=1,this.shape="square",this.color=e.selected,this.outlineColor=e.outline,g(this,t)}apply(e){e.color=d(this.color),e.size=this.size,e.outlineSize=this.outlineSize,e.outlineColor=d(this.outlineColor),e.primitive=this.shape}}class y{constructor({colors:e,...t}){this.innerWidth=1,this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=f,this.globalAlphaContrastBoost=1.5,this.radius=3,this.innerColor=e.selected,this.glowColor=e.accent,this.heightFillColor=e.accent,g(this,t)}apply(e,t=1){const r={glowColor:n.toUnitRGB(this.glowColor),glowFalloff:this.glowFalloff,glowWidth:this.glowWidth,innerColor:n.toUnitRGB(this.innerColor),innerWidth:this.innerWidth,globalAlpha:this.globalAlpha*t*this.glowColor.a,globalAlphaContrastBoost:this.globalAlphaContrastBoost,intersectsLineRadius:this.radius};"style"in e?e.style=r:e.laserlineStyle=r}}class ie{constructor(e){this.outline=new w({colors:e,color:e.stippleOff,renderOccluded:o.OccludeAndTransparentStencil,stippleOffColor:e.stippleOn,innerWidth:0}),this.staged=new w({colors:e,color:e.stippleOn,renderOccluded:o.OccludeAndTransparentStencil,innerColor:e.stagedSolid,stippleOffColor:e.stippleOff}),this.shadowStyle=new y({colors:e,globalAlpha:f,glowColor:e.accent,glowFalloff:8,glowWidth:8,innerColor:e.selected,innerWidth:1})}}class le{constructor(e){this.outline=new se({colors:e,color:e.selected,outlineColor:e.outline,outlineSize:1,shape:"circle",size:4}),this.shadowStyle=new y({colors:e,globalAlpha:f,glowColor:e.accent,glowFalloff:1.5,glowWidth:6,innerColor:e.selected,innerWidth:1,radius:2})}}class oe extends w{constructor({colors:e,...t}){super({colors:e}),this.extensionType=$.GROUND_RAY,g(this,t)}}class ne{constructor(e){this.laserlineAlphaMultiplier=1.5,this.heightPlaneAngleCutoff=20,this.lineGraphics=new ie(e),this.pointGraphics=new le(e),this.heightPlane=new y({colors:e,globalAlpha:f,glowColor:e.accent,glowFalloff:8,glowWidth:8,innerColor:e.selected,innerWidth:1}),this.heightBox=new y({colors:e,globalAlpha:f,glowColor:e.accent,glowFalloff:8,glowWidth:8,innerColor:e.selected,innerWidth:0,heightFillColor:e.accent}),this.zVerticalLine=new oe({colors:e,color:_(e.accent,5*f/3),falloff:2,innerColor:_(e.selected,0),renderOccluded:o.OccludeAndTransparent,stipplePattern:null,width:5,extensionType:$.GROUND_RAY})}}let c=class extends E{constructor(e){super(e)}get colors(){const e=this.getTheme().accentColor,t=e.a;return{accent:e,contrast:T(e),selected:n.fromArray([255,255,255,t]),selectedOutline:n.fromArray([255,255,255,t]),staged:n.fromArray([12,207,255,t]),stagedSolid:n.fromArray([12,207,255,1]),outline:n.fromArray([0,0,0,.5*t]),stippleOn:n.fromArray([255,255,255,1]),stippleOff:n.fromArray([0,0,0,.5])}}get visualElements(){return new ne(this.colors)}get manipulators(){return new re(this.colors)}get zManipulator(){return new ee(this.colors)}};l([a()],c.prototype,"colors",null),l([a()],c.prototype,"visualElements",null),l([a()],c.prototype,"manipulators",null),l([a()],c.prototype,"zManipulator",null),l([a()],c.prototype,"getTheme",void 0),c=l([D("esri.views.3d.interactive.editingTools.settings.Settings")],c);class ge extends X{constructor(e){super(e),this._attachmentOrigin=F(0,0,0,null),this._attachmentOriginDirty=!0,this.events=new W,this._geometry=null,this._width=1,this._color=A(1,0,1,1),this._innerWidth=0,this._innerColor=A(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._falloff=0,this._elevationInfo=null,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=o.OccludeAndTransparentStencil,this._attachmentOrigin.spatialReference=e.view.spatialReference,this._laserline=new Z({view:e.view,isDecoration:e.isDecoration}),this.applyProperties(e),this.attached=e.attached??!0}destroy(){this._laserline.destroy(),super.destroy()}createObject3DResourceFactory(e){return{view:e,createResources:t=>this._createObject3DResources(t),destroyResources:t=>this._destroyExternalResources(t),recreateGeometry:(t,r)=>{t.geometries.length=0,this._recreateGeometry(r,t.material,t.geometries)}}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:t=>this._destroyExternalResources(t),recreateGeometry:t=>{t.geometries=this._createRenderGeometriesDraped(t.material),this._attachmentOriginChanged()}}}get _laserlineAttached(){return this.attached&&this.visible&&this._laserlineStyle!=null&&!this.isDraped&&this.laserlineEnabled}onAttachedChange(e){this._laserline.attached=this._laserlineAttached,e&&this._attachmentOriginChanged()}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.recreateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){O(e,this._color)||(v(this._color,e),this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){O(e,this._innerColor)||(v(this._innerColor,e),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=e!=null!=(this._stipplePattern!=null);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){e&&this._stippleOffColor&&O(e,this._stippleOffColor)||(this._stippleOffColor=e?Q(e):null,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,this._laserline.attached=this._laserlineAttached,e!=null&&(this._laserline.style=e)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this._laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get attachmentOrigin(){var r;if(!this._attachmentOriginDirty)return this._attachmentOrigin;const e=(r=this.object3dResources.resources)==null?void 0:r.geometries;if(!e||e.length===0)return null;j(p,0,0,0);let t=0;for(const i of e)i.computeAttachmentOrigin(P)&&(I(p,p,P),t++);return t===0?null:(H(p,p,1/t),this.view.renderCoordsHelper.fromRenderCoords(p,this._attachmentOrigin),this._attachmentOriginDirty=!1,this._attachmentOrigin)}_updateMaterial(){this.object3dResources.resources!=null&&this.object3dResources.resources.material.setParameters(this._materialParameters),this.drapedResources.resources!=null&&this.drapedResources.resources.material.setParameters(this._materialParameters)}get _isClosed(){return this.geometry!=null&&this.geometry.type==="polygon"}get _materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:!1,isClosed:this._isClosed,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,join:"round",hasPolygonOffset:!0,renderOccluded:this._normalizedRenderOccluded,isDecoration:this.isDecoration}}get _normalizedRenderOccluded(){return this.isDraped&&this._renderOccluded===o.OccludeAndTransparentStencil?o.OccludeAndTransparent:this._renderOccluded}_recreateGeometry(e,t,r){this._createRenderGeometries(t,r);for(const i of r)e.addGeometry(i);this._attachmentOriginChanged()}_attachmentOriginChanged(){this._attachmentOriginDirty=!0,this.events.emit("attachment-origin-changed")}_destroyExternalResources(e){e.geometries=[]}_createObject3DResources(e){const t=new b(this._materialParameters),r=new Array;return this._recreateGeometry(e,t,r),{material:t,geometries:r,forEach:i=>{i(t),r.forEach(i)}}}_createDrapedResources(){const e=new b(this._materialParameters);return{material:e,geometries:this._createRenderGeometriesDraped(e)}}_createRenderGeometriesDraped(e){const{geometry:t,view:r}=this,i=r.basemapTerrain.spatialReference;return t==null||i==null?[]:B(t,i).lines.map(({position:h})=>{const m={overlayInfo:{spatialReference:i,renderCoordsHelper:r.renderCoordsHelper},attributeData:{position:h},removeDuplicateStartEnd:this._isClosed};return new U(R(e,m))})}calculateMapBounds(e){if(this.object3dResources.resources==null)return!1;const t=this.view.renderCoordsHelper;for(const r of this.object3dResources.resources.geometries){const i=r.attributes.get(k.POSITION),h=q(i.data.length);L(i.data,t.spatialReference,0,h,this.view.spatialReference,0,i.data.length/3),V(e,h)}return!0}_createRenderGeometries(e,t){const r=this.geometry;if(r==null)return;const i=N(r,this.view.elevationProvider,this.view.renderCoordsHelper,Y.fromElevationInfo(this.elevationInfo??new J({mode:K(r,null)}))),h=new Array;for(const{position:m,mapPositions:z}of i.lines){const G={mapPositions:z,attributeData:{position:m},removeDuplicateStartEnd:this._isClosed};t.push(R(e,G)),h.push(m)}this._laserline.pathVerticalPlane=h}}const P=S(),p=S();let u=class extends W.EventedAccessor{constructor(s){super(s),this.tracking=!1,this.displaying=!1,this.isDraped=!1}};l([a({constructOnly:!0})],u.prototype,"graphic",void 0),l([a()],u.prototype,"tracking",void 0),l([a()],u.prototype,"displaying",void 0),l([a()],u.prototype,"isDraped",void 0),u=l([D("esri.views.3d.layers.graphics.GraphicState")],u);export{u as e,ge as w,c as z};
