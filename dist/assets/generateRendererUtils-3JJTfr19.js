import{dp as C,e as v,iy as I,y as g,c as S,dr as F,R as B}from"./index-pCX-0tJH.js";const q=new C({esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation",esriClassifyDefinedInterval:"defined-interval"}),w=new C({esriNormalizeByLog:"log",esriNormalizeByPercentOfTotal:"percent-of-total",esriNormalizeByField:"field"});let V=class extends F{constructor(s){super(s),this.type="class-breaks-definition",this.breakCount=null,this.classificationField=null,this.classificationMethod=null,this.normalizationField=null,this.normalizationType=null}set standardDeviationInterval(s){this.classificationMethod==="standard-deviation"&&this._set("standardDeviationInterval",s)}set definedInterval(s){this.classificationMethod==="defined-interval"&&this._set("definedInterval",s)}};v([I({classBreaksDef:"class-breaks-definition"})],V.prototype,"type",void 0),v([g({json:{write:!0}})],V.prototype,"breakCount",void 0),v([g({json:{write:!0}})],V.prototype,"classificationField",void 0),v([g({type:String,json:{read:q.read,write:q.write}})],V.prototype,"classificationMethod",void 0),v([g({json:{write:!0}})],V.prototype,"normalizationField",void 0),v([g({json:{read:w.read,write:w.write}})],V.prototype,"normalizationType",void 0),v([g({value:null,json:{write:!0}})],V.prototype,"standardDeviationInterval",null),v([g({value:null,json:{write:!0}})],V.prototype,"definedInterval",null),V=v([S("esri.rest.support.ClassBreaksDefinition")],V);const A=V,N=B.getLogger("esri.rest.support.generateRendererUtils");function M(a,s){return Number(a.toFixed(s))}function O(a){const{normalizationTotal:s}=a;return{classBreaks:j(a),normalizationTotal:s}}function j(a){const s=a.definition,{classificationMethod:n,normalizationType:i,definedInterval:h}=s,f=s.breakCount??1,u=[];let l=a.values;if(l.length===0)return[];l=l.sort((r,c)=>r-c);const d=l[0],p=l[l.length-1];if(n==="equal-interval")if(l.length>=f){const r=(p-d)/f;let c=d;for(let t=1;t<f;t++){const e=M(d+t*r,6);u.push({minValue:c,maxValue:e,label:b(c,e,i)}),c=e}u.push({minValue:c,maxValue:p,label:b(c,p,i)})}else l.forEach(r=>{u.push({minValue:r,maxValue:r,label:b(r,r,i)})});else if(n==="natural-breaks"){const r=D(l),c=a.valueFrequency||r.valueFrequency,t=$(r.uniqueValues,c,f);let e=d;for(let o=1;o<f;o++)if(r.uniqueValues.length>o){const m=M(r.uniqueValues[t[o]],6);u.push({minValue:e,maxValue:m,label:b(e,m,i)}),e=m}u.push({minValue:e,maxValue:p,label:b(e,p,i)})}else if(n==="quantile")if(l.length>=f&&d!==p){let r=d,c=Math.ceil(l.length/f),t=0;for(let e=1;e<f;e++){let o=c+t-1;o>l.length&&(o=l.length-1),o<0&&(o=0),u.push({minValue:r,maxValue:l[o],label:b(r,l[o],i)}),r=l[o],t+=c,c=Math.ceil((l.length-t)/(f-e))}u.push({minValue:r,maxValue:p,label:b(r,p,i)})}else{let r=-1;for(let c=0;c<l.length;c++){const t=l[c];t!==r&&(r=t,u.push({minValue:r,maxValue:t,label:b(r,t,i)}),r=t)}}else if(n==="standard-deviation"){const r=L(l),c=_(l,r);if(c===0)u.push({minValue:l[0],maxValue:l[0],label:b(l[0],l[0],i)});else{const t=E(d,p,f,r,c)*c;let e=0,o=d;for(let y=f;y>=1;y--){const k=M(r-(y-.5)*t,6);u.push({minValue:o,maxValue:k,label:b(o,k,i)}),o=k,e++}let m=M(r+.5*t,6);u.push({minValue:o,maxValue:m,label:b(o,m,i)}),o=m,e++;for(let y=1;y<=f;y++)m=e===2*f?p:M(r+(y+.5)*t,6),u.push({minValue:o,maxValue:m,label:b(o,m,i)}),o=m,e++}}else if(n==="defined-interval"){if(!h)return u;const r=l[0],c=l[l.length-1],t=Math.ceil((c-r)/h);let e=r;for(let o=1;o<t;o++){const m=M(r+o*h,6);u.push({minValue:e,maxValue:m,label:b(e,m,i)}),e=m}u.push({minValue:e,maxValue:c,label:b(e,c,i)})}return u}function b(a,s,n){let i=null;return i=a===s?n&&n==="percent-of-total"?a+"%":a.toString():n&&n==="percent-of-total"?a+"% - "+s+"%":a+" - "+s,i}function D(a){const s=[],n=[];let i=Number.MIN_VALUE,h=1,f=-1;for(let u=0;u<a.length;u++){const l=a[u];l===i?(h++,n[f]=h):l!==null&&(s.push(l),i=l,h=1,n.push(h),f++)}return{uniqueValues:s,valueFrequency:n}}function $(a,s,n){const i=a.length,h=[];n>i&&(n=i);for(let u=0;u<n;u++)h.push(Math.round(u*i/n-1));h.push(i-1);let f=z(h,a,s,n);return T(f.mean,f.sdcm,h,a,s,n)&&(f=z(h,a,s,n)),h}function z(a,s,n,i){let h=[],f=[],u=[],l=0;const d=[],p=[];for(let e=0;e<i;e++){const o=x(e,a,s,n);d.push(o.sbMean),p.push(o.sbSdcm),l+=p[e]}let r,c=l,t=!0;for(;t||l<c;){t=!1,h=[];for(let e=0;e<i;e++)h.push(a[e]);for(let e=0;e<i;e++)for(let o=a[e]+1;o<=a[e+1];o++)if(r=s[o],e>0&&o!==a[e+1]&&Math.abs(r-d[e])>Math.abs(r-d[e-1]))a[e]=o;else if(e<i-1&&a[e]!==o-1&&Math.abs(r-d[e])>Math.abs(r-d[e+1])){a[e+1]=o-1;break}c=l,l=0,f=[],u=[];for(let e=0;e<i;e++){f.push(d[e]),u.push(p[e]);const o=x(e,a,s,n);d[e]=o.sbMean,p[e]=o.sbSdcm,l+=p[e]}}if(l>c){for(let e=0;e<i;e++)a[e]=h[e],d[e]=f[e],p[e]=u[e];l=c}return{mean:d,sdcm:p}}function T(a,s,n,i,h,f){let u=0,l=0,d=0,p=0,r=!0;for(let c=0;c<2&&r;c++){c===0&&(r=!1);for(let t=0;t<f-1;t++)for(;n[t+1]+1!==n[t+2];){n[t+1]=n[t+1]+1;const e=x(t,n,i,h);d=e.sbMean,u=e.sbSdcm;const o=x(t+1,n,i,h);if(p=o.sbMean,l=o.sbSdcm,!(u+l<s[t]+s[t+1])){n[t+1]=n[t+1]-1;break}s[t]=u,s[t+1]=l,a[t]=d,a[t+1]=p,r=!0}for(let t=f-1;t>0;t--)for(;n[t]!==n[t-1]+1;){n[t]=n[t]-1;const e=x(t-1,n,i,h);d=e.sbMean,u=e.sbSdcm;const o=x(t,n,i,h);if(p=o.sbMean,l=o.sbSdcm,!(u+l<s[t-1]+s[t])){n[t]=n[t]+1;break}s[t-1]=u,s[t]=l,a[t-1]=d,a[t]=p,r=!0}}return r}function E(a,s,n,i,h){let f=Math.max(i-a,s-i)/h/n;return f=f>=1?1:f>=.5?.5:.25,f}function L(a){let s=0;for(let n=0;n<a.length;n++)s+=a[n];return s/=a.length,s}function _(a,s){let n=0;for(let i=0;i<a.length;i++){const h=a[i];n+=(h-s)*(h-s)}return n/=a.length,Math.sqrt(n)}function x(a,s,n,i){let h=0,f=0;for(let d=s[a]+1;d<=s[a+1];d++){const p=i[d];h+=n[d]*p,f+=p}f<=0&&N.warn("Exception in Natural Breaks calculation");const u=h/f;let l=0;for(let d=s[a]+1;d<=s[a+1];d++)l+=i[d]*(n[d]-u)**2;return{sbMean:u,sbSdcm:l}}export{O as a,A as d};
